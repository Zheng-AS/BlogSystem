<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <script src="jquery-3.3.1.js"></script>
    <script
            type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/wangeditor@latest/dist/wangEditor.min.js"></script>
    <style>
        .toolbar {
            border: 1px solid #ccc;
        }
        .text {
            border: 1px solid #ccc;
            min-height: 400px;
        }
    </style>
</head>
<body>
<label>
<input type="text"  placeholder="标题"  width="10000" id="title" >
</label>
<div>
    <div id="toolbar-container" class="toolbar"></div>
</div>

<!-- 引入 wangEditor.min.js -->
    <form id="form" method="post">
        <div id="contentDiv"></div>
        <textarea name="content" id="content" style="display:none" ></textarea>
    </form>
<label class="btn btn-primary">
    <select class="form-control" style="..." id="tag">
        <option value="">选择分类标签</option>
        <option value="人工智能">人工智能</option>
        <option value="前端">前端</option>
        <option value="架构">架构</option>
        <option value="区块链">区块链</option>
        <option value="数据库">数据库</option>
        <option value="5G">5G</option>
        <option value="游戏开发">游戏开发</option>
        <option value="大数据">大数据</option>
    </select>
</label>
<label class="btn btn-primary">
    <select class="form-control" style="..." id="isPublic">
        <option value="否">设为隐私</option>
        <option value="是">公开</option>
    </select>
</label>
<button type="button" class="btn btn-default" onclick="submitData()">保存</button>

<form id="form2" method="post" action="/psdn/blog/upload">
    <input type="text" id="title1" name="title" style="display: none"/>
    <input type="text" id="tag1" name="tag" style="display: none"/>
    <input type="text" id="imgUrl1" name="imgUrl" style="display: none"/>
    <input type="text" id="content1" name="content" style="display: none"/>
    <input type="text" id="isPublic1" name="isPublic" style="display: none"/>
</form>

</body>
<script>
    var data = {
        title : "",
        tag : "",
        imgUrl : [],
        content :"",
        isPublic :""
    }

    var E = window.wangEditor;
    var editor = new E('#contentDiv')
    var $text1 = $('#content');
    editor.config.onchange = function (html) {
        // 监控变化，同步更新富文本内容到 textarea
        $text1.val(html);

    }
    editor.config.uploadImgServer = '/psdn/blog/imgUpload';	//自定义上传图片（改成自己写的图片上传方法的路径）
    editor.config.uploadFileName = 'imgFile';	//自定义文件名
    editor.config.uploadImgHooks = {
        customInsert: function (insertImg, result, editor) {
            var url = result.url;
            console.log(data.imgUrl)
            data.imgUrl.push(url)
            insertImg(url)
            alert(result.msg);
        }
    }
    editor.config.onchange = (html)=>{
        console.log(html)

            for(var i in data.imgUrl){
                var newArr = [];
                var re = new  RegExp(data.imgUrl[i]);
                //已经删除
                if(!re.test(html)){
                    data.imgUrl = data.imgUrl.filter(item=> item!==data.imgUrl[i]);
                }
            }



        console.log(data.imgUrl)
        // var reg = /src
    }
    editor.config.customAlert = function (info) {	//关闭默认提示信息
        // info 是需要提示的内容
        alert('自定义提示：' + info)
    }
    editor.create();
    $text1.val(editor.txt.html());



    function submitData() {
        data.tag = $('#tag option:selected').val()
        data.title = $('#title').val()
        data.isPublic = $('#isPublic option:selected').val()
        data.content = editor.txt.text()

        $("#title1").val(data.title)
        $("#tag1").val(data.tag)
        $("#isPublic1").val(data.isPublic)
        $("#content1").val(data.content)
        $("#imgUrl1").val(data.imgUrl)

        $("#form2").submit()
        /*console.log(data)
        $.ajax({
            type: "POST",
            url: "/psdn/blog/upload",
            data: JSON.stringify(data),
            cache: false,
            contentType: "application/x-www-form-urlencoded" ,    //不可缺
            processData: false,    //不可缺
            dataType:"JSON",
            success: function(ret) {
                console.log(ret);
                alert(ret)
            },
            error:function(d){
                console.log(d)
            }
        })*/
    }


</script>
</body>
</html>